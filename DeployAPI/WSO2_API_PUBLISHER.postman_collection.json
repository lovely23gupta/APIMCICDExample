{
	"info": {
		"_postman_id": "5d7404fd-8c37-4091-a7e6-fca854da0562",
		"name": "WSO2_API_PUBLISHER",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Dynamic Client Registration",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "88facc10-bf99-4069-be50-b5489e737a18",
						"exec": [
							"var base64Key = btoa(postman.getEnvironmentVariable(\"username\") + ':' + postman.getEnvironmentVariable(\"password\"));",
							"postman.setEnvironmentVariable(\"base64Key\", base64Key);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "9eb0d465-a0a4-439b-961f-7d66b9bf038d",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"var base64CICS = btoa(jsonData.clientId + ':' + jsonData.clientSecret);",
							"",
							"console.log(\"CI : \" + jsonData.clientId);",
							"console.log(\"CS : \" + jsonData.clientSecret);",
							"",
							"",
							"postman.setEnvironmentVariable(\"base64CICS\", base64CICS);",
							"",
							"console.log(base64CICS)"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Basic {{base64Key}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"callbackUrl\": \"www.google.lk\",\n    \"clientName\": \"rest_api_publisher\",\n    \"tokenScope\": \"Production\",\n    \"owner\": \"admin\",\n    \"grantType\": \"password refresh_token\",\n    \"saasApp\": true\n}"
				},
				"url": {
					"raw": "{{serverURL}}/client-registration/v0.14/register",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"client-registration",
						"v0.14",
						"register"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Access Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "39583d48-8c64-4bff-b176-e04d816e9fb3",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"access_token\", jsonData.access_token);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Basic {{base64CICS}}"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "scope",
							"value": "apim:api_view apim:api_create apim:api_publish",
							"type": "text"
						},
						{
							"key": "grant_type",
							"value": "password",
							"type": "text"
						},
						{
							"key": "username",
							"value": "{{username}}",
							"type": "text"
						},
						{
							"key": "password",
							"value": "{{password}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{gatewayURL}}/token",
					"host": [
						"{{gatewayURL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Existing API",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "0f741247-db9d-4174-956b-5499fc063cac",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"if (jsonData.count === 1) {",
							"   postman.setNextRequest(\"Update swagger definition\");",
							"   ",
							"   postman.setEnvironmentVariable(\"apiStatus\", jsonData.list[0].status); ",
							"   postman.setEnvironmentVariable(\"apiId\", jsonData.list[0].id);",
							"",
							"  ",
							"}",
							"",
							"",
							"",
							"",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{serverURL}}/api/am/publisher/v0.14/apis?query=name:{{apiName}}",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"am",
						"publisher",
						"v0.14",
						"apis"
					],
					"query": [
						{
							"key": "query",
							"value": "name:{{apiName}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Create an API",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "4c3c1bc8-ae84-4e74-aa3e-568254581894",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"apiId\", jsonData.id);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n\t\"id\": \"7a2298c4-c905-403f-8fac-38c73401631f\",\r\n\t\"name\": \"{{apiName}}\",\r\n\t\"description\": \"{{apiName}}\",\r\n\t\"context\": \"\/{{apiContext}}\",\r\n\t\"version\": \"1.0.0\",\r\n\t\"provider\": \"{{username}}\",\r\n\t\"apiDefinition\": \"{}\",\r\n\t\"wsdlUri\": null,\r\n\t\"responseCaching\": \"Disabled\",\r\n\t\"cacheTimeout\": 300,\r\n\t\"destinationStatsEnabled\": null,\r\n\t\"isDefaultVersion\": false,\r\n\t\"type\": \"HTTP\",\r\n\t\"transport\": [\r\n\t\t\"http\",\r\n\t\t\"https\"\r\n\t],\r\n\t\"tags\": [\"foo\"],\r\n\t\"tiers\": [\"Unlimited\"],\r\n\t\"maxTps\": {\r\n\t\t\"sandbox\": 5000,\r\n\t\t\"production\": 1000\r\n\t},\r\n\t\"thumbnailUri\": null,\r\n\t\"visibility\": \"PUBLIC\",\r\n\t\"visibleRoles\": [],\r\n\t\"visibleTenants\": [],\r\n\t\"endpointConfig\": \"{\\\"production_endpoints\\\":{\\\"url\\\":\\\"{{backendAPIEndpoint}}\\\",\\\"config\\\":null},\\\"sandbox_endpoints\\\":{\\\"url\\\":\\\"{{backendAPIEndpoint}}\\\",\\\"config\\\":null},\\\"endpoint_type\\\":\\\"http\\\"}\",\r\n\t\"gatewayEnvironments\": \"Production and Sandbox\",\r\n\t\"sequences\": [],\r\n\t\"subscriptionAvailability\": null,\r\n\t\"subscriptionAvailableTenants\": [],\r\n\t\"businessInformation\": {\r\n\t\t\"businessOwnerEmail\": \"{{username}}\",\r\n\t\t\"technicalOwnerEmail\": \"{{username}}\",\r\n\t\t\"technicalOwner\": \"{{username}}\",\r\n\t\t\"businessOwner\": \"{{username}}\"\r\n\t},\r\n\t\"corsConfiguration\": {\r\n\t\t\"accessControlAllowOrigins\": [\"*\"],\r\n\t\t\"accessControlAllowHeaders\": [\r\n\t\t\t\"authorization\",\r\n\t\t\t\"Access-Control-Allow-Origin\",\r\n\t\t\t\"Content-Type\",\r\n\t\t\t\"SOAPAction\"\r\n\t\t],\r\n\t\t\"accessControlAllowMethods\": [\r\n\t\t\t\"GET\",\r\n\t\t\t\"PUT\",\r\n\t\t\t\"POST\",\r\n\t\t\t\"DELETE\",\r\n\t\t\t\"PATCH\",\r\n\t\t\t\"OPTIONS\"\r\n\t\t],\r\n\t\t\"accessControlAllowCredentials\": false,\r\n\t\t\"corsConfigurationEnabled\": false\r\n\t}\r\n}"				},
				"url": {
					"raw": "{{serverURL}}/api/am/publisher/v0.14/apis",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"am",
						"publisher",
						"v0.14",
						"apis"
					]
				}
			},
			"response": []
		},
		{
			"name": "Update swagger definition",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "d0e86ecd-475d-4b9f-8fb7-3364a6bf1630",
						"exec": [
							"if (postman.getEnvironmentVariable(\"apiStatus\") === \"PUBLISHED\") {",
							"   postman.setNextRequest(null);",
							"  ",
							"}",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "multipart/form-data"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "apiDefinition",
							"type": "file",
							"src": "DeployAPI/swagger.json"
						}
					]
				},
				"url": {
					"raw": "{{serverURL}}/api/am/publisher/v0.14/apis/{{apiId}}/swagger",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"am",
						"publisher",
						"v0.14",
						"apis",
						"{{apiId}}",
						"swagger"
					]
				},
				"description": "This operation can be used to update the swagger definition of an existing API. Swagger definition to be updated is passed as a form data parameter `apiDefinition`.\n"
			},
			"response": []
		},
		{
			"name": "Change Life Cycle",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {},
				"url": {
					"raw": "{{serverURL}}/api/am/publisher/v0.14/apis/change-lifecycle?action=Publish&apiId={{apiId}}",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"am",
						"publisher",
						"v0.14",
						"apis",
						"change-lifecycle"
					],
					"query": [
						{
							"key": "action",
							"value": "Publish"
						},
						{
							"key": "apiId",
							"value": "{{apiId}}"
						}
					]
				}
			},
			"response": []
		}
	]
}
